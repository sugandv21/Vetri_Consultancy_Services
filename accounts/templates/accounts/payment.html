{% extends "accounts/base.html" %}
{% block content %}

<div class="row justify-content-center mt-5">
  <div class="col-md-5">
    <div class="card shadow text-center">
      <div class="card-body">

        <!-- PLAN TITLE -->
        <h4 class="mb-2">{{ plan_name }} Subscription</h4>

        <!-- PLAN DESCRIPTION -->
        <p class="text-muted">
          {% if plan_name == "Pro" %}
            Unlock AI guidance, resume optimization and priority job access
          {% else %}
            Includes mentor sessions, mock interviews & recruiter introductions
          {% endif %}
        </p>

        <!-- PRICE -->
        <h2 class="mb-4">â‚¹{{ amount }}</h2>

        <!-- PAYMENT SUBMIT -->
        {% comment %} <form method="post">
          {% csrf_token %}
          <button type="submit" class="btn btn-success w-100">
            Pay Now
          </button>
        </form>  {% endcomment %}


        <button id="rzp-button" class="btn btn-success w-100">
          Pay Now
        </button>

        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

        <script>
        // get csrf token from cookie (Django recommended method)
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        const csrftoken = getCookie('csrftoken');
        
        var options = {
            "key": "{{ razorpay_key }}",
            "amount": "{{ amount|floatformat:0 }}00",
            "currency": "INR",
            "name": "Vetri Consultancy Services",
            "description": "{{ plan_name }} Subscription",
            "order_id": "{{ order_id }}",
        
            "handler": function (response){
        
                fetch("{% url 'verify_subscription_payment' %}", {
                    method: "POST",
                    credentials: "same-origin",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": csrftoken
                    },
                    body: JSON.stringify(response)
                })
                .then(res => res.json())
                .then(data => {
                    window.location.href = data.redirect_url;
                });
            },
        
            "theme": {
                "color": "#198754"
            }
        };
        
        var rzp1 = new Razorpay(options);
        
        document.getElementById('rzp-button').onclick = function(e){
            rzp1.open();
            e.preventDefault();
        }
        </script>


        

        <!-- NOTE -->
        <p class="text-muted mt-3 small">
          After successful payment your plan will be activated instantly.
        </p>

      </div>
    </div>
  </div>
</div>

{% endblock %}



