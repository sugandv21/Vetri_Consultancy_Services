{% extends "accounts/base.html" %}
{% block content %}

<form method="get" class="row g-2 mb-3">

  <div class="col-md-3">
    <select name="plan" class="form-select">
      <option value="">All Subscriptions</option>
      <option value="FREE"  {% if request.GET.plan == "FREE" %}selected{% endif %}>Free</option>
      <option value="PRO"  {% if request.GET.plan == "PRO" %}selected{% endif %}>Pro</option>
      <option value="PRO_PLUS" {% if request.GET.plan == "PRO_PLUS" %}selected{% endif %}>Pro Plus</option>
    </select>
  </div>

  <div class="col-md-3">
    <select name="stage" class="form-select">
      <option value="">All Hiring Stages</option>
      <option value="PENDING" {% if request.GET.stage == "PENDING" %}selected{% endif %}>Pending Applications</option>
      <option value="INTERVIEW" {% if request.GET.stage == "INTERVIEW" %}selected{% endif %}>Interviews Scheduled</option>
    </select>
  </div>

  <div class="col-md-2">
    <button class="btn btn-primary w-100">Filter</button>
  </div>

  <div class="col-md-2">
    <a href="{% url 'candidate_list' %}" class="btn btn-outline-secondary w-100">Reset</a>
  </div>

</form>


<h3 class="mb-4">Candidates</h3>

<div class="card shadow-sm">
  <div class="card-body p-0">

<!-- Responsive wrapper -->
<div class="table-responsive">
  <table class="table table-striped mb-0 align-middle candidate-table">

    <thead class="table-dark">
      <tr>
        <th>Email</th>
        <th>Full Name</th>
        <th>Experience</th>
        <th>Location</th>
        <th>Skills</th>
        <th>Subscription</th>
        <th>Joined</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for user in candidates %}
      <tr>
        <td data-label="Email">
          {{ user.email }}
        </td>

        <td data-label="Full Name">
          {{ user.profile.full_name|default:"â€”" }}
        </td>

        <td data-label="Experience">
          {% if user.profile.experience is not None %}
            {{ user.profile.experience }} yrs
          {% else %}
            â€”
          {% endif %}
        </td>

        <td data-label="Location">
          {{ user.profile.location|default:"â€”" }}
        </td>

        <td data-label="Skills">
          {{ user.profile.skills|default:"â€”" }}
        </td>

      
        <td data-label="Subscription">

          <!-- PLAN -->
          <span class="badge
            {% if user.plan == 'FREE' %}bg-secondary
            {% elif user.plan == 'PRO' %}bg-info
            {% elif user.plan == 'PRO_PLUS' %}bg-success
            {% endif %}
          ">
            {{ user.plan }}
          </span>

          <!-- STATUS -->
          <span class="badge
            {% if user.plan_status == 'ACTIVE' %}bg-success
            {% elif user.plan_status == 'EXPIRED' %}bg-danger
            {% else %}bg-warning text-dark
            {% endif %}
          ">
            {{ user.plan_status }}
          </span>

          <!-- EXPIRY DATE -->
          {% if user.plan != 'FREE' and user.plan_end %}
            <div class="small text-muted">
              Till: {{ user.plan_end|date:"d M Y" }}
            </div>
          {% endif %}

        </td>


      



        <td data-label="Joined">
          {{ user.date_joined|date:"d M Y" }}
        </td>

        <td data-label="Actions">
          <a href="{% url 'candidate_detail' user.id %}"
             class="btn btn-sm btn-outline-primary w-100">
            View
          </a>
        </td>
      </tr>

      {% empty %}
      <tr>
        <td colspan="8" class="text-center py-4">
          No candidates found.
        </td>
      </tr>
      {% endfor %}
    </tbody>

  </table>
</div>


  </div>
</div>
<style>
@media (max-width: 768px) {

  /* ðŸ”¥ STOP bootstrap horizontal scroll */
  .table-responsive {
    overflow-x: visible !important;
  }

  /* hide header */
  .candidate-table thead {
    display: none;
  }

  /* break table structure */
  .candidate-table,
  .candidate-table tbody,
  .candidate-table tr,
  .candidate-table td {
    display: block;
    width: 100%;
  }

  /* card row â€” centered */
  .candidate-table tr {
    background: #fff;
    border-radius: 14px;
    padding: 14px;
    margin: 0 0 16px 0;
    box-shadow: 0 4px 14px rgba(0,0,0,.08);
  }

  /* cell */
  .candidate-table td {
    text-align: left;
    border: none;
    border-bottom: 1px solid #f1f1f1;
    position: relative;
    padding: 10px 10px 10px 50%;
    font-size: 14px;
    min-height: 40px;

    /* allow long email + skills wrap */
    white-space: normal !important;
    word-break: break-word;
  }

  .candidate-table td:last-child {
    border-bottom: none;
    padding-top: 14px;
  }

  /* labels */
  .candidate-table td::before {
    content: attr(data-label);
    position: absolute;
    left: 0;
    top: 10px;
    width: 44%;
    padding-left: 2px;
    font-weight: 600;
    color: #555;
    font-size: 13px;
  }

  /* button */
  .candidate-table .btn {
    width: 100%;
    margin-top: 6px;
  }
}
</style>


{% endblock %}
