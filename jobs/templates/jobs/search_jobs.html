{% extends "accounts/base.html" %}
{% block content %}

<h3 class="mb-3 text-center text-md-start">Search Jobs</h3>

<form method="get" class="row g-2 mb-4">
  <!-- Location -->
  <div class="col-12 col-md-4">
    <input
      class="form-control"
      name="location"
      placeholder="Location"
      value="{{ request.GET.location }}"
    >
  </div>

  <!-- Job Type -->
  <div class="col-12 col-md-3">
    <select class="form-control" name="job_type">
      <option value="">Job Type</option>
      <option value="FT" {% if request.GET.job_type == "FT" %}selected{% endif %}>
        Full-time
      </option>
      <option value="IN" {% if request.GET.job_type == "IN" %}selected{% endif %}>
        Internship
      </option>
      <option value="CT" {% if request.GET.job_type == "CT" %}selected{% endif %}>
        Contract
      </option>
    </select>
  </div>

  <!-- Experience -->
  <div class="col-12 col-md-3">
    <input
      type="number"
      class="form-control"
      name="exp"
      placeholder="Experience (years)"
      value="{{ request.GET.exp }}"
      min="0"
    >
  </div>

  <!-- Buttons -->
  <div class="col-12 col-md-2 d-grid gap-2">
    <button class="btn btn-primary">
      Filter
    </button>

    <a href="{% url 'search_jobs' %}" class="btn btn-outline-secondary">
      Reset
    </a>

    <a href="{% url 'search_jobs' %}?match=1"
       class="btn btn-success">
      Matching Jobs
    </a>
  </div>
</form>

{% if is_matching %}
  <div class="alert alert-success text-center">
    Showing jobs matching your profile skills
  </div>
{% endif %}

<div class="row">
  {% for job in jobs %}
    <div class="col-12 col-md-6 col-lg-4 mb-3">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">

          <h5 class="card-title">
            <a href="{% url 'job_detail' job.id %}">
              {{ job.title }}
            </a>
          </h5>

          <p class="mb-1">
            {{ job.company_name }}
          </p>

          <p class="text-muted mb-1">
            {{ job.location }}
          </p>

          <p class="mb-3">
            Experience: {{ job.experience_min }} â€“ {{ job.experience_max }} yrs
          </p>

          <div class="mt-auto">
            {% if job.visibility == "PRO" and not request.user.is_pro %}
              <span class="badge bg-warning">PRO Job</span>
              <p class="text-muted small mt-2">
                Upgrade to PRO to apply
              </p>
            {% else %}
              <div class="d-flex flex-column flex-md-row gap-2">
                <a href="{% url 'save_job' job.id %}"
                  class="btn btn-outline-secondary btn-sm flex-md-fill">
                  Save
                </a>

                <a href="{% url 'apply_job' job.id %}"
                  class="btn btn-primary btn-sm flex-md-fill">
                  Apply
                </a>
              </div>
            {% endif %}
          </div>

        </div>
      </div>
    </div>
  {% empty %}
    <p class="text-center">No jobs available.</p>
  {% endfor %}
</div>

{% if jobs.paginator.num_pages > 1 %}
<nav>
  <ul class="pagination justify-content-center flex-wrap">

    {% if jobs.has_previous %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ jobs.previous_page_number }}">
          Previous
        </a>
      </li>
    {% endif %}

    <li class="page-item active">
      <span class="page-link">
        {{ jobs.number }} / {{ jobs.paginator.num_pages }}
      </span>
    </li>

    {% if jobs.has_next %}
      <li class="page-item">
        <a class="page-link"
           href="?page={{ jobs.next_page_number }}">
          Next
        </a>
      </li>
    {% endif %}

  </ul>
</nav>
{% endif %}

{% endblock %}
